# Login Service
At the very moment of game experience, it is critical to ensure user's progress is not lost, or even worse, stolen.

This service allows players to prove themselves, in a bunch of different ways.

## REST API

Please refer to the <a href="doc/API.md">API Documentation</a> for more information.

## Login process

Authentication process takes these steps:

1. Player provides <a href="#credentials">credentials</a> and <a href="#scope-of-access">scopes of access</a>;
2. The system verifies if the credentials in question are valid.
Each credential defines different way of verification;
3. <a href="#player-accounts">Account</a> for the user is revealed. 
If there's no account for such credential, a new one is created;
4. System verifies if the account has the scopes requested;
5. <a href="#access-tokens">Access token</a> for the account is generated;

## Player Accounts

Login service have simple account system: 
each player have unique personal account number attached to him. 
If the user is logged in for a first time, a new account is created automatically.

Then, the main purpose of Login Service is to verify that player `X` owns account `N`.

## Gamespace

As time goes, you may want to have multiple games hosted on the same environment.

Login service offers a special term for that purpose: `gamespace`. 
It allows to split the game experience from other games, 
like a `namespace` keyword in various programming languages. Yet they run
on the same software server-side.
 
For example, if you would like to divide mobile player from PC once, 
you may put them in different gamespaces. But if you want to combine them,
put them under the same gamespace.
 
## Credentials

Say a bowling club provides a free game for clients who's birthday today.
To prove the day of birth, a client may profide a passport, or driver's license,
or even a birth certificate. 

These are different kinds of documents, but they prove same identity.

That's where the credential system kick in: player may have multiple credentials
that prove same account. For example, user could login using `google` or `facebook`,
but both of them will lead to the same account.

Please see <a href="doc/API.md#credential-types">API Documentation</a> for a complete list of credential types.
 
## Scope of Access

At some point, there should be a way to ensure the player `A` has the right to do
something, but player `B` has not.

For example, administrative account can move mountains, while simple guest account
can do only simple operations.

Access Scopes are used to ensure that. At authentication, player sends the complete
list of access scopes he needs, then the system makes sure he owns them.
 
## Access tokens

Instead of checking if user have a certain access right for each request, 
login service uses <a href="https://jwt.io">Json Web Tokens</a> to ensure user's identity.

Basically, it's a JSON object with all information about the player:

* Token's UUID itself
* Player's account ID
* Player's credential
* Scopes of Access
* Issue and Expiration Date

So each service during request process does not have to lookup if the player
have the access rights, but can lookup this object instead.

In order to validate if the Token was actually generated by Login service,
a <a href="https://en.wikipedia.org/wiki/Public-key_cryptography">public-key cryptography</a> method is used:

1. An RSA public/private key pair is generated on Login service on service setup. The private key is kept
secure with paraphrase protection on it. Public key, instead, is copied for each service.
2. Once a Token is generated, it is signed using a private key only a Login service knows.
3. Other services verify it using public key.

In addition, there's a system that ensures the only one token 
is valid for account at the same time, to avoid using same account from multiple devices.